{"ast":null,"code":"import axios from'axios';import{jwtDecode}from'jwt-decode';axios.defaults.baseURL=\"http://localhost:5068\";setAuthorizationBearer();function saveAccessToken(authResult){localStorage.setItem(\"access_token\",authResult.token);setAuthorizationBearer();}function setAuthorizationBearer(){const myToken=localStorage.getItem(\"access_token\");if(myToken)axios.defaults.headers.common[\"Authorization\"]=\"Bearer \".concat(myToken);}axios.interceptors.response.use(response=>{return response;},error=>{if(error.status==401&&window.location.pathname!=='/login'){window.location.href='/login';// דרך ישירה להפנות לדף login\n}else{console.log(\"\\u05D0\\u05E8\\u05E2\\u05D4 \\u05E9\\u05D2\\u05D9\\u05D0\\u05D4!!! \\u05E7\\u05D5\\u05D3 \\u05E9\\u05D2\\u05D9\\u05D0\\u05D4: \".concat(error.status,\" , \\u05D4\\u05D5\\u05D3\\u05E2\\u05EA \\u05E9\\u05D2\\u05D9\\u05D0\\u05D4: \").concat(error.response.massage||error.massage));return Promise.reject(error);// תחזיר את השגיאה כדי שהקוד יוכל להמשיך לטפל בה אם צריך\n}});const getUserIdFromToken=token=>{const base64Url=token.split('.')[1];const base64=base64Url.replace(/-/g,'+').replace(/_/g,'/');const jsonPayload=decodeURIComponent(atob(base64).split('').map(function(c){return'%'+('00'+c.charCodeAt(0).toString(16)).slice(-2);}).join(''));const payload=JSON.parse(jsonPayload);// שימוש בשם ה-claim שמתאים לטוקן שלך (לדוגמה 'sub' או 'NameIdentifier')\nreturn JSON.parse(jsonPayload).id;// כאן אני מניח שה-ID נמצא ב-claim שנקרא 'sub'\n};export default{logout:()=>{localStorage.setItem(\"access_token\",\"\");},login:async(userName,password)=>{await setAuthorizationBearer();const res=await axios.post(\"/login\",{nameUser:userName,password:password});if(res.data.token){console.log(\"Token received:\",res.data.token);saveAccessToken(res.data.token);}else{console.error(\"Login failed, no token received\");}},register:async(userName,password)=>{var d=0;const res=await axios.post(\"/registr\",{id:d,NameUser:userName,password:password});console.log(\"Login Response:\",res.data);saveAccessToken(res.data.token);},getLoginUser:()=>{const token=localStorage.getItem(\"access_token\");if(token){const currentTime=Math.floor(Date.now()/1000);// זמן נוכחי בשניות\nreturn token.exp>currentTime;}return false;},getIdUser:()=>{const token=localStorage.getItem(\"access_token\");if(token){return jwtDecode(token).id;}return null;},getTasks:async()=>{const token=localStorage.getItem(\"access_token\");const user=jwtDecode(token).id;const result=await axios.get(\"/tasks?id=\".concat(user));return result.data;},addTask:async name=>{const token=localStorage.getItem(\"access_token\");const user=getUserIdFromToken(token);const result=await axios.post(\"/tasks?newTask=\".concat(encodeURIComponent(name),\"&id=\").concat(user));return result.status;},setCompleted:async(id,isComplete)=>{const result=await axios.put(\"/tasks/\".concat(id));return{};},deleteTask:async id=>{const result=await axios.delete(\"/tasks/\".concat(id));return result.status;}};","map":{"version":3,"names":["axios","jwtDecode","defaults","baseURL","setAuthorizationBearer","saveAccessToken","authResult","localStorage","setItem","token","myToken","getItem","headers","common","concat","interceptors","response","use","error","status","window","location","pathname","href","console","log","massage","Promise","reject","getUserIdFromToken","base64Url","split","base64","replace","jsonPayload","decodeURIComponent","atob","map","c","charCodeAt","toString","slice","join","payload","JSON","parse","id","logout","login","userName","password","res","post","nameUser","data","register","d","NameUser","getLoginUser","currentTime","Math","floor","Date","now","exp","getIdUser","getTasks","user","result","get","addTask","name","encodeURIComponent","setCompleted","isComplete","put","deleteTask","delete"],"sources":["D:/limudim/praktikod/project_3 ToDoList/ToDoListReact-master/src/service.js"],"sourcesContent":["import axios from 'axios';\nimport { jwtDecode } from 'jwt-decode';\n\naxios.defaults.baseURL = \"http://localhost:5068\";\nsetAuthorizationBearer()\n\nfunction saveAccessToken(authResult){\n  localStorage.setItem(\"access_token\", authResult.token)\n  setAuthorizationBearer()\n}\n\nfunction setAuthorizationBearer(){\n  const myToken = localStorage.getItem(\"access_token\")\n  if(myToken) \n    axios.defaults.headers.common[\"Authorization\"] = `Bearer ${myToken}`\n}\n\naxios.interceptors.response.use(\n    response => {\n      return response},\n    error => {\n      if (error.status == 401 && window.location.pathname !== '/login') {\n        window.location.href = '/login';  // דרך ישירה להפנות לדף login\n      }\n      else{\n        console.log(`ארעה שגיאה!!! קוד שגיאה: ${error.status} , הודעת שגיאה: ${error.response.massage || error.massage}`)\n        return Promise.reject(error);  // תחזיר את השגיאה כדי שהקוד יוכל להמשיך לטפל בה אם צריך\n      }\n    })\nconst getUserIdFromToken = (token) => {\n      const base64Url = token.split('.')[1];\n      const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');\n      const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {\n          return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);\n      }).join(''));\n    \n      const payload = JSON.parse(jsonPayload);\n      \n      // שימוש בשם ה-claim שמתאים לטוקן שלך (לדוגמה 'sub' או 'NameIdentifier')\n      return JSON.parse(jsonPayload).id;  // כאן אני מניח שה-ID נמצא ב-claim שנקרא 'sub'\n    }\n\n\nexport default {\n  logout: () => {\n    localStorage.setItem(\"access_token\",\"\")\n  },\n\n  login: async (userName, password) => {\n    await setAuthorizationBearer();  \n    const res = await axios.post(\"/login\", {nameUser: userName, password: password});\n    \n    if (res.data.token) {\n        console.log(\"Token received:\", res.data.token);\n        saveAccessToken(res.data.token);\n    } else {\n        console.error(\"Login failed, no token received\");\n    }\n},\n  register: async (userName, password) => {\n    var d = 0\n    const res = await axios.post(\"/registr\",{id:d,NameUser:userName, password:password})\n    console.log(\"Login Response:\", res.data);  \n    saveAccessToken(res.data.token)\n  },\n\n  getLoginUser: () => {\n    const token = localStorage.getItem(\"access_token\")\n    if(token){\n      const currentTime = Math.floor(Date.now() / 1000); // זמן נוכחי בשניות\n      return token.exp > currentTime;\n    }\n    return false\n  },\n\n  getIdUser: () => {\n    const token = localStorage.getItem(\"access_token\")\n    if(token){\n      return jwtDecode(token).id\n    }\n    return null\n  },\n  getTasks: async () => {    \n    const token = localStorage.getItem(\"access_token\");\n    const user = jwtDecode(token).id\n    const result = await axios.get(`/tasks?id=${user}`);\n     return result.data;\n  },\n\n  addTask: async(name)=>{\n    const token = localStorage.getItem(\"access_token\");\n    const user = getUserIdFromToken(token)\n    const result = await axios.post(`/tasks?newTask=${encodeURIComponent(name)}&id=${user}`);\n    return result.status;\n  },\n\n  setCompleted: async(id, isComplete)=>{\n    const result = await axios.put(`/tasks/${id}`)\n    return {};\n  },\n\n  deleteTask:async(id)=>{\n    const result = await axios.delete(`/tasks/${id}`);\n    return result.status;\n  }\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}